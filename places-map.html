<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Real Meeter - baza danych interakcji społecznych</title>
        <link rel="stylesheet" href="styles.css">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
        <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">
    </head>
    <body>
        <header>
            Baza danych spotkań
        </header>
        <div class="container">
            <nav class="left-menu">
            </nav>
            <div id="main">
                <h1>Miejsca, w których byłeś</h1>
                <div id="allPlacesMap"></div>
            </div>
            <aside class="right-menu">
                <!-- Right menu content goes here -->
            </aside>
        </div>
        <footer id="footer">
            Map and superpowers icons by <a target="_blank" href="https://icons8.com/">icons8.com</a>. <br>
            <a target="_blank" href="https://www.flaticon.com/free-icons/archer" title="archer icons">Archer icons created by Leremy - Flaticon</a>
            Meeter project by Piotr Szkudlarek
        </footer>
    </body>
    <script src="./createLeftMenu.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>
    <script>
        createLeftMenu()
        async function createMap() {
            let map = L.map('allPlacesMap').setView([52.2297, 21.0122], 13)
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map)
            let markersGroup = []
            try {
                const placesReq = await fetch(`http://localhost:3000/get-visited-places`)
                const placesJson = await placesReq.json()
                for (let place of placesJson) {
                    console.log(place)
                    let marker = L.marker([place.lat, place.lng]).addTo(map)
                    marker.bindPopup(`<b>${place.place_name}</b><br>${place.category}`)
                    markersGroup.push(marker)
                    
                }
                map.fitBounds(L.featureGroup(markersGroup).getBounds())
            }
            catch (error) {
                alert(`Nie udało się narysować rzeczy na mapie! <br> Tekst błędu: ${error}.`)
            }
        }
        createMap()
    </script>
</html>